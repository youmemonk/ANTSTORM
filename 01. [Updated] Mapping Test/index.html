<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <h1>Assets and Templates</h1>

    <!-- Cycle dropdown -->
    <div>
        <select name="Cycle" id="Cycle" onchange="selectCycle()">
            <!-- <select name="Cycle" id="Cycle"> -->
            <option value="" disabled selected>Select a Business cycle
            </option>
            <option value="Consulting">Consulting
            </option>
            <option value="Delivery">Delivery
            </option>
        </select>
    </div>

    <!-- <button onclick="buttonclick()">Click</button> -->

    <!-- BU dropdown -->
    <div>
        <select id="BUDropdown" onchange="selectBU()">
            <option value="" disabled selected>Select Business Unit (BU)
            </option>
        </select>
    </div>

    <script>
        var rootSheetData;
        //! [Updated with Google Sheets now instead of Drive]
        //* Fetch data from Server Side
        var delArray = [];
        var consArray = [];
        // var commonArray = [];
        // var temp = [];
        function dummyFunction(dt) {
            console.log('Data Fetch Running...');
            rootSheetData = dt[0];
            buSheetData = dt[1];
            productSheetData = dt[2];

            // console.log(productSheetData)

            // var cycleParameter = document.getElementById('Cycle').value;
            //* Get Delivery Array
            for (var i = 0; i < rootSheetData.length; i++) {
                if (rootSheetData[i]["BU"].includes("Delivery")) {
                    delArray.push(rootSheetData[i]);
                }
            }
            // delArray = temp.slice();
            //* Get Consulting Array
            for (var i = 0; i < rootSheetData.length; i++) {
                if (rootSheetData[i]["BU"].includes("Consulting")) {
                    consArray.push(rootSheetData[i]);
                }
            }
        }

        //* Server Side Function Call
        google.script.run
            .withSuccessHandler(dummyFunction)
            .withUserObject(this)
            .RootFolderMapping();

        //* Get Selected Cycle Data from RootSheet
        // function buttonclick(){
        //   console.log(delArray);
        //   console.log(consArray);
        // }

        var temp2 = [];
        var buList = [];

        function selectCycle() {
            var cycleParameter = document.getElementById("Cycle").value;
            var commonarray = [];
            // if(cycleParameter == 'Delivery'){
            //   var trial =
            // }

            if (cycleParameter == "Delivery") {
                // console.log(delArray);
                // var trial = delArray[0]["BU"].split(' ');
                // console.log(trial[0]);
                for (var i = 0; i < delArray.length; i++) {
                    // temp2[0][i].push(delArray[i]["BU"].split(' ')[0]);
                    // temp2[1][i].push(delArray[i]["Template File ID"])
                    temp2.push([delArray[i]["BU"].split(' ')[0], delArray[i]["Template File ID"]]);
                }
                // console.log(temp2)
                buList = temp2.slice();
                temp2 = []; //* empty temp
                // console.log(buList)
            } else {
                // console.log(consArray);
                for (var i = 0; i < consArray.length; i++) {
                    // temp2.push(consArray[i]["BU"].split(' ')[0]);
                    temp2.push([consArray[i]["BU"].split(' ')[0], consArray[i]["Template File ID"]]);
                }
                buList = temp2.slice();
                temp2 = []; //* empty temp
                // console.log(buList)
            }

            //* Feed Data to next dropdown
            //! [IMPORTANT] Confirm acronyms from mapping sheet and then push
            console.log(buSheetData[6])


            var list = [];
            for (var i = 0; i < buList.length; i++) {
                list.push(`<option value=${buList[i][0]}>` + `${buList[i][0]}` + "</option>");
            }
            document.getElementById("BUDropdown").innerHTML = list.join();
            // console.log(list)
            list = [];

            // console.log(productSheetData);

            // console.log(document.getElementById('BUDropdown').value)
        }

        function selectBU() {
            // console.log(document.getElementById('BUDropdown').value);
            var BUparam = document.getElementById('BUDropdown').value;
            var sheetIndex;
            for (var i = 0; i < buList.length; i++) {
                if (buList[i][0] == BUparam) {
                    sheetIndex = buList[i][1];
                }
            }
            google.script.run
                .withSuccessHandler(newdummyFunction)
                .withUserObject(this)
                .fetchData(sheetIndex)

            //! [IMPORTANT] If index == null -> Alert No sheet Found
            // console.log(index)
            // return sheetIndex;
        }

        function newdummyFunction(dt) {
            console.log(dt);
        }
    </script>
</body>

</html>